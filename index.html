<?php session_start(); ?>
<html>
  <!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
  <!-- [if !IE]><! -->
  <head>
    <meta lang="cz" />
    <meta charset="utf-8" />
    <title>Farma Častrov - Produkujeme maso tím nejlepším způsobem</title>
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-resource@1.3.4"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/locale/cs.js"></script>
    <script src="https://unpkg.com/vee-validate@2.0.0-rc.17/dist/vee-validate.js"></script>

    <!-- GA -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=UA-130166855-1"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "UA-130166855-1");
    </script>

    <meta
      content="Jsme malá farma na Vysočině a chováme masná hovězí plemena, kozy a ovce z kterých produkujeme vlastní maso."
      name="description"
    />
    <meta content="{{ csrf_token() }}" name="csrf-token" />
    <meta content="Farma Castrov" name="author" />
    <meta
      content="width=device-width, initial-scale=1, maximum-scale=1"
      name="viewport"
    />
    <link href="css/style.css" rel="stylesheet" />
    <!-- <script src="js/map.js"></script> -->
    <style>
      .hero,
      .card {
        background-size: cover;
        background-position: 50% 50%;
        position: relative;
      }

      .hero-body {
        display: flex;
        align-items: center;
        position: relative;
      }

      .overlay {
        top: 0;
        z-index: 100;
        left: 0;
        width: 100%;

        background-image: linear-gradient(
          141deg,
          rgba(100, 25, 2, 0.6) 50%,
          rgba(100, 25, 2, 0.3) 100%
        );
      }
    </style>
  </head>
  <body>
    <script>
      Vue.use(VeeValidate, {
        errorBagName: "vErrors"
      });
      Vue.Validator;
    </script>
    <div id="root" v-cloak="">
      <nav class="header navbar" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
          <a class="navbar-item header-navbar-item" href="https://bulma.io">
            <img src="images/LOGO-WHITE.png" />
            <div class="p-l-xs is-size-6">Farma Častrov</div>
          </a>

          <a
            role="button"
            class="navbar-burger burger has-background-warning"
            aria-label="menu"
            aria-expanded="false"
            data-target="navbarBasicExample"
          >
            <span class="has-background-dark" aria-hidden="true"></span>
            <span class="has-background-dark" aria-hidden="true"></span>
            <span class="has-background-dark" aria-hidden="true"></span>
          </a>
        </div>

        <div id="navbarBasicExample" class="navbar-menu">
          <div class="navbar-end">
            <a class="navbar-item"> Ceník masa </a>

            <a class="navbar-item"> Kontakt a pobočky </a>
          </div>
        </div>
      </nav>

      <section
        class="welcome hero is-large is-bold is-white is-fullheight"
        style="background-image: url('images/welcome-3.jpg');"
      >
        <div class="hero-body overlay">
          <div class="container">
            <h1 class="title is-size-1 has-text-white is-size-3-mobile p-b-md">
              Maso z vyšlechtěných plemen
            </h1>
            <h2 class="subtitle has-text-white is-size-6-mobile">
              Objednejte si bedýnku a ochutnejte maso z Vysočiny.
            </h2>
            <button class="button is-warning is-large">Aktuální nabídka</button>
          </div>
        </div>
      </section>
      <section class="section">
        <div class="container">
          <h1 class="title has-text-centered is-size-3 p-md">
            Aktuální nabídky
          </h1>

          <div
            class="columns is-multiline is-centered is-mobile"
            v-for="offer in offers"
          >
            <div class="notification is-info" v-if="loading">
              Vteřinku... Načítáme výpis nabídek
            </div>
            <div class="card column is-12 is-paddingless">
              <div class="offer p-sm">
                <span style="display: none;"> {{ offer.id }} </span>
                <p class="title is-5 ">Bedýnka: {{ offer.name }}</p>
                <p class="subtitle is-6 ">Plemeno: {{ offer.animal }}</p>
                <p class="subtitle is-6">
                  Datum porážky: {{ offer.date_finish | moment }}
                </p>
                <button
                  id="open-modal"
                  class="button is-warning is-medium modal-button"
                  data-target="modal-bis"
                  @click="selectOffer(offer)"
                >
                  Objednat
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="hero is-medium has-background-light">
        <div class="hero-body">
          <div class="container">
            <h1 class="title">Jak to funguje?</h1>
            <div class="pros-row columns is-multiline">
              <div class="proces-item column is-3">
                <strong> Aktuální nabídka </strong>
                <p>Porážky plánujeme dopředu a visí na webových stránkách.</p>
              </div>
              <div class="proces-item column is-3">
                <strong> Výběr produktů </strong>
                <p>
                  Maso prodáváme v bedýnkách, obvykle 5 a 10 kg. U skopového je
                  možný odběr celého kusu.
                </p>
              </div>
              <div class="proces-item column is-3">
                <strong> Objednání </strong>
                <p>
                  Objednejte si z přehledu porážek. Máte-li individuální
                  požadavky kontaktujte nás.
                </p>
              </div>
              <div class="proces-item column is-3">
                <strong> Platba a předání </strong>
                <p>Zboží si můžete vyzvednout v naší provozovně v Častrově.</p>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section class="hero is-medium has-background-white">
        <div class="hero-body">
          <div class="container">
            <h1 class="title">Přoč nakoupit u nás?</h1>
            <div class="pros-row columns is-multiline">
              <div class="pros-item column is-3">
                <strong> Masná plemena </strong>
                <p>
                  Chováme šlechtěná masná plemena, která mají správné
                  předpoklady pro chuť masa.
                </p>
              </div>
              <div class="pros-item column is-3">
                <strong> Přirozený chov dobytka </strong>
                <p>
                  Přirozený chov dobytka na pastvinách vyhovuje požadavkům
                  ekologického zemědělství.
                </p>
              </div>
              <div class="pros-item column is-3">
                <strong> Zrání masa </strong>
                <p>
                  Naše chladírenské prostory zajistí správnou vyzrálost tak, aby
                  maso bylo křehké, šťavnaté a měkké.
                </p>
              </div>
              <div class="pros-item column is-3">
                <strong> Garance původu </strong>
                <p>
                  Garantujeme původ masa rodokmenem, který obsahuje informace o
                  porážce.
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section class="hero is-medium has-background-light">
        <div class="hero-body">
          <div class="container">
            <h1 class="title">Kontaktuje nás</h1>
            <div class="pros-row columns is-multiline">
              <div class="pros-item column is-4">
                <p class="is-size-6 ">info@farmacastrov.cz</p>
                <p class="is-size-6 p-b-lg">Mob.: +420 722 696 522</p>
                <p class="is-size-5 has-text-weight-semibold p-b-md">
                  Kdy máme otevřeno
                </p>
                <p class="is-size-6">pátek 16:00 - 19:30</p>
                <p class="is-size-6">sobota 8:30-11:30</p>
                <p class="is-size-6 p-b-lg">
                  po telefonické domluvě lze individuálně.
                </p>
                <p class="is-size-5 has-text-weight-semibold p-b-md">
                  Rodinná farma Častrov
                </p>
                <p class="is-size-6">MVDr. Ondřej Pána Častrov 87</p>
                <p class="is-size-6 p-b-md">394 63 Častrov</p>
                <p class="is-size-6">IČO: 72086050</p>
                <p class="is-size-6 p-b-md">DIČ: CZ8704251611</p>
              </div>
              <div class="pros-item column is-8">
                <iframe
                  src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2013.2840576146903!2d15.183637783466306!3d49.30887100856712!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x470cddc99196011d%3A0xbea89e516479f7c7!2sProdej+ryb+%E2%80%93+Karel+a+syn!5e0!3m2!1scs!2scz!4v1543789918014"
                  width="100%"
                  height="500"
                  frameborder="0"
                  style="border:0"
                  allowfullscreen
                ></iframe>
              </div>
            </div>
          </div>
        </div>
      </section>

      <div id="modal-bis" class="offer-detail modal">
        <div class="modal-background"></div>
        <div class="modal-content">
          <!-- Any other Bulma elements you want -->
          <button
            @click="exitModal()"
            aria-label="close"
            class="modal-close is-large is-pulled-right"
          ></button>
          <div class="box" v-if="showModalContent">
            <div class="section is-paddingless" v-if="showModalCustomer">
              <p class="title is-4">{{ clickedOffer.name }}</p>
              <p class="subtitle is-6 is-marginless">
                Plemeno: {{ clickedOffer.animal }}
              </p>
              <p class="subtitle is-6">
                Datum výdeje: {{ clickedOffer.date_finish | moment }}
              </p>
              <!-- <div v-html="clickedOffer.description"></div> -->

              <!-- <p class="box-offer-prize"> -->
              <!-- </p> -->
            </div>
            <div class="section is-paddingless" v-if="showModalSuccess">
              <h3>
                Děkujeme za Vaši objednávku
                <span class="italic"> {{ addData.fullname }} </span>
              </h3>
              <p>Podívejte se na Váš email <br /></p>

              <p>
                <strong> {{ addData.email }} </strong>
              </p>
              <br />
              poslali jsme Vám shrnutí objednávky. <br />
              <p></p>
              <button @click="exitModal()" class="btn btn-primary">
                Vrátit zpět
              </button>
            </div>
            <div class="section is-paddingless" v-if="showModalCustomer">
              <div class="offer-detail__choose is-flex-tablet p-b-md p-t-md">
                <div class="field is-marginless">
                  <label class="label has-text-weight-light"
                    >Zvolte počet a typ bedýnky</label
                  >
                  <div class="control">
                    <input class="input is-primary" v-model="count" value="1" />
                  </div>
                </div>
                <div class="field p-l-md">
                  <!--
                    <label class="label has-text-weight-light">Zvolte typ bedýnky</label>
                  -->
                  <div class="control">
                    <label class="radio" for="one">
                      <input
                        class="radio"
                        id="one"
                        type="radio"
                        v-model="size"
                        value="5"
                      />
                      5kg bedýnka
                    </label>
                    <label class="radio" for="two">
                      <input
                        class="radio"
                        id="two"
                        type="radio"
                        v-model="size"
                        value="10"
                      />
                      10kg bedýnka
                    </label>
                  </div>
                </div>
              </div>

              <form v-on:submit.prevent="addOrder()" class="">
                <div class="control p-b-lg">
                  <label
                    class="label has-text-weight-light"
                    v-bind:class="{ 'is-danger': errors.fullname }"
                  >
                    Zadejte celé jméno
                  </label>
                  <input
                    style="visibility: hidden; display: none;"
                    type="text"
                    v-model="addData.id"
                  />
                  <input
                    class="input is-primary m-b-sm"
                    placeholder="Jméno a Příjmení"
                    type="text"
                    v-bind:class="{ 'is-danger': errors.fullname }"
                    v-model="addData.fullname"
                  />
                  <p
                    :errors="errors"
                    class="help is-danger"
                    v-if="errors.fullname"
                  >
                    {{ errors.fullname[0] }}
                  </p>
                  <label
                    class="label has-text-weight-light"
                    v-bind:class="{ 'is-danger': errors.email }"
                  >
                    Email
                  </label>
                  <input
                    class="input is-primary m-b-sm"
                    placeholder="Vasemail@email.cz"
                    type="text"
                    v-bind:class="{ 'is-danger': errors.email }"
                    v-model="addData.email"
                  />
                  <p
                    :errors="errors"
                    class="help is-danger"
                    v-if="errors.email"
                  >
                    {{ errors.email[0] }}
                  </p>
                  <label
                    class="label has-text-weight-light"
                    v-bind:class="{ 'is-danger': errors.phone }"
                  >
                    Mobil
                  </label>
                  <input
                    class="input is-primary m-b-sm"
                    placeholder="777555111"
                    type="text"
                    v-bind:class="{ 'is-danger': errors.phone }"
                    v-model="addData.phone"
                  />
                  <p
                    :errors="errors"
                    class="help is-danger"
                    v-if="errors.phone"
                  >
                    {{ errors.phone[0] }}
                  </p>
                </div>
                <div class="offer-detail__sent is-flex-tablet">
                  <p class="title is-5 is-marginless p-r-lg">
                    Celková cena:
                    <span class="title is-5"
                      >{{ count * size * clickedOffer.prize }} Kč</span
                    >
                  </p>
                  <button class="button is-warning is-medium">Odeslat objednávku</button>
                </div>
                <!-- </div> -->
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>

  <script>
    window.onload = function() {
      document.querySelector("#open-modal").addEventListener("click", function(event) {
          event.preventDefault();
          var modal = document.querySelector(".modal"); // assuming you have only 1
          var html = document.querySelector("html");
          modal.classList.add("is-active");
          html.classList.add("is-clipped");

          var elementsArray = modal.querySelectorAll(
            ".modal-close, .modal-background"
          );
          elementsArray.forEach(function(elem) {
            elem.addEventListener("click", function(e) {
              console.log(e);
              e.preventDefault();
              modal.classList.remove("is-active");
              html.classList.remove("is-clipped");
            });
          });
        });
    };
  </script>
  <script>
    Vue.http.options.emulateJSON = true
    var app = new Vue({
      el: "#root",
      data: {
        loading: true,
        size: "10",
        count: "1",
        offers: {},
        showModal: false,
        showModalContent: false,
        showModalCustomer: false,
        showModalSuccess: false,
        clickedoffer: {},
        addData: {
          fullname: "",
          phone: "",
          email: "",
          count: "",
          size: "",
          id: ""
        },
        submitted: false,
        errors: []
      },
      mounted: function() {
        this.getAllUsers();
      },
      methods: {
        getAllUsers: function() {
          // GET /someUrl
          this.loading = true;
          this.$http.get("https://laravel.farmacastrov.cz/api/nabidky").then(
            response => {
              // get body data
              this.loading = false;
              this.offers = response.data;
              console.log("ready");
            }
            // response => {}
          );
        },
        selectOffer(offer) {
          console.log(offer);
          app.clickedOffer = offer;
          this.addData.id = app.clickedOffer.id;
          this.showModal = true;
          this.showModalContent = true;
          this.showModalCustomer = true;
          this.showModalSuccess = false;
          Vue.set(this, "errors", "");
        },
        exitModal() {
          this.showModal = false;
          this.showModalContent = false;
          this.showModalCustomer = false;
          this.showModalSuccess = false;

          Vue.set(this, "errors", "");
        },
        addOrder: function() {
          this.addData.size = this.size;
          this.addData.count = this.count;
          this.$http
            .post("https://laravel.farmacastrov.cz/order", this.addData)
            .then(
              response => {
                Vue.set(this, "errors", response.body.errors);
                if (!this.errors) {
                  this.showModalCustomer = false;
                  this.showModalSuccess = true;
                }
              },
              response => {}
            );
          Vue.set(this, "errors", "");
        }
      },
      filters: {
        moment: function(date) {
          return moment(date).format("ll");
        }
      }
    });
  </script>
</html>
